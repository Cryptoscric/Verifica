<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Dex Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #06b6d4;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        body { background-color: #05070a; }
    </style>
</head>
<body class="text-gray-100 min-h-screen font-sans">

    <div class="max-w-3xl mx-auto px-4 py-10">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-black tracking-tight text-white mb-2">
                SOL<span class="text-cyan-500">TRACKER</span>
            </h1>
            <p class="text-gray-400 text-sm">Analizza i movimenti on-chain in tempo reale</p>
        </header>
        
        <div class="bg-[#11141b] p-5 rounded-3xl border border-gray-800 shadow-2xl mb-6">
            <div class="space-y-4">
                <div>
                    <input id="walletAddr" type="text" placeholder="Wallet Address (es. 86xCn...)" 
                           class="w-full bg-[#1a1f29] border border-gray-700 rounded-2xl p-4 text-sm focus:ring-2 focus:ring-cyan-500 outline-none transition">
                </div>
                <div>
                    <input id="tokenMint" type="text" placeholder="Token Mint Address (es. DeZp...)" 
                           class="w-full bg-[#1a1f29] border border-gray-700 rounded-2xl p-4 text-sm focus:ring-2 focus:ring-cyan-500 outline-none transition">
                </div>
                <button onclick="fetchHistory()" id="searchBtn" 
                        class="w-full bg-cyan-600 hover:bg-cyan-500 font-bold py-4 rounded-2xl transition-all shadow-lg shadow-cyan-900/20 flex justify-center items-center gap-2">
                    Analizza Trade
                </button>
            </div>
        </div>

        <div id="resultsContainer" class="space-y-3">
            <p class="text-center text-gray-600 py-10">Inserisci gli indirizzi per iniziare</p>
        </div>
    </div>

    <script>
        const API_KEY = "a6bc9ad2-91f8-43f7-a9a9-ec820daadc1b"; 

        async function fetchHistory() {
            const wallet = document.getElementById('walletAddr').value.trim();
            const tokenMint = document.getElementById('tokenMint').value.trim();
            const container = document.getElementById('resultsContainer');
            const btn = document.getElementById('searchBtn');

            if (!wallet || !tokenMint) return alert("Compila tutti i campi!");

            btn.disabled = true;
            btn.innerHTML = '<div class="loading-spinner"></div>';
            container.innerHTML = '';

            try {
                const response = await fetch(`https://api.helius.xyz/v0/addresses/${wallet}/transactions?api-key=${API_KEY}`);
                const data = await response.json();

                const relevantTxs = data.filter(tx => 
                    tx.tokenTransfers && tx.tokenTransfers.some(t => t.mint === tokenMint)
                );

                if (relevantTxs.length === 0) {
                    container.innerHTML = '<div class="text-center p-10 bg-[#11141b] rounded-3xl border border-gray-800 text-gray-500">Nessuna transazione trovata per questo token.</div>';
                } else {
                    relevantTxs.forEach(tx => {
                        const date = new Date(tx.timestamp * 1000).toLocaleString('it-IT', { hour: '2-digit', minute:'2-digit', day:'2-digit', month:'short' });
                        
                        let type = "Transfer";
                        let amount = 0;
                        let colorClass = "text-gray-400";
                        let icon = "⇄";

                        tx.tokenTransfers.forEach(t => {
                            if (t.mint === tokenMint) {
                                amount = t.tokenAmount;
                                if (t.toUser === wallet) {
                                    type = "ACQUISTO";
                                    colorClass = "text-green-400";
                                    icon = "↓";
                                } else if (t.fromUser === wallet) {
                                    type = "VENDITA";
                                    colorClass = "text-red-400";
                                    icon = "↑";
                                }
                            }
                        });

                        container.innerHTML += `
                            <div class="bg-[#11141b] p-4 rounded-2xl border border-gray-800 flex items-center justify-between hover:border-gray-600 transition">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center font-bold ${colorClass}">
                                        ${icon}
                                    </div>
                                    <div>
                                        <div class="font-bold text-sm ${colorClass}">${type}</div>
                                        <div class="text-[10px] text-gray-500">${date}</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="font-mono font-bold">${amount.toLocaleString(undefined, {maximumFractionDigits: 2})}</div>
                                    <a href="https://solscan.io/tx/${tx.signature}" target="_blank" class="text-[10px] text-cyan-500 hover:underline">Vedi su Solscan</a>
                                </div>
                            </div>
                        `;
                    });
                }
            } catch (e) {
                container.innerHTML = '<div class="p-4 bg-red-900/20 text-red-400 rounded-xl text-center">Errore durante il caricamento.</div>';
            } finally {
                btn.disabled = false;
                btn.textContent = "Analizza Trade";
            }
        }
    </script>
</body>
</html>
